digraph G{
Node0 [label = "58sub_40711031:
sub     esp, 124h
mov     eax, ___security_cookie
xor     eax, esp
mov     [esp+124h+var_4], eax
mov     eax, [esp+124h+arg_0]
push    ebx
push    ebp
mov     ebp, [esp+12Ch+arg_4]
push    esi
mov     esi, [eax+8]
add     esi, 6
mov     eax, esi
push    edi
mov     [esp+134h+var_11C], 0
lea     ecx, [eax+1]
lea     esp, [esp+0]"]
Node1 [label = "mov     dl, [eax]
add     eax, 1
test    dl, dl
jnz     short loc_407150"]
Node2 [label = "sub     eax, ecx
mov     [esp+134h+var_120], eax
cdq
push    edx
push    eax
mov     edi, 40h
mov     ebx, esi
call    sub_40A8D0
add     esp, 8
test    ebp, ebp
mov     edi, eax
mov     [esp+134h+var_118], edi
jz      loc_407559"]
Node3 [label = "cmp     byte ptr [ebp+2], 0Ah
jnz     loc_407559"]
Node4 [label = "call    sub_40F300
test    eax, eax
jnz     short loc_40719C"]
Node5 [label = "push    offset aNosocket; \"nosocket\"
jmp     loc_407560"]
Node6 [label = "push    offset aWs_0    ; \"ws\"
call    sub_412750
push    eax
call    sub_41F960
add     esp, 8
test    eax, eax
jnz     short loc_4071BD"]
Node7 [label = "push    offset a_z_wsUndefined; \".z.ws undefined\"
jmp     loc_407560"]
Node8 [label = "mov     eax, [esp+134h+var_120]
cmp     edi, eax
jge     short loc_4071D8"]
Node9 [label = "add     edi, 1
sub     eax, edi
mov     [esp+134h+var_11C], esi
mov     [esp+134h+var_118], edi
mov     [esp+134h+var_120], eax
add     esi, edi"]
Node10 [label = "cmp     eax, 0FFh
jle     short loc_4071E9"]
Node11 [label = "push    offset aUrlTooLong; \"url too long\"
jmp     loc_407560"]
Node12 [label = "cdq
push    edx
push    eax
mov     edi, 3Ah
mov     ebx, esi
call    sub_40A8D0
mov     edi, eax
add     esp, 8
cmp     edi, 0FFh
mov     eax, 0FFh
jg      short loc_40720C"]
Node13 [label = "mov     eax, edi"]
Node14 [label = "cdq
push    edx
push    eax
lea     eax, [esp+13Ch+name]
push    esi
push    eax
call    sub_40FCB0
mov     byte ptr [eax], 0
mov     eax, [esp+144h+var_120]
add     edi, 1
add     esp, 10h
cmp     edi, eax
jge     short loc_40723D"]
Node15 [label = "sub     eax, edi
push    eax
add     edi, esi
push    edi
call    sub_415900
add     esp, 8
mov     ebx, eax
jmp     short loc_407242"]
Node16 [label = "mov     ebx, 50h"]
Node17 [label = "mov     edi, [ebp+8]
push    offset asc_4566EC; \"\\r\\n\\r\\n\"
lea     eax, [ebp+10h]
push    edi
push    eax
call    sub_4016D0
mov     esi, eax
lea     ecx, [edi+ebp+0Ch]
add     esp, 0Ch
cmp     esi, ecx
jz      short loc_40726B"]
Node18 [label = "push    offset aBadRNRN ; \"bad \\\\r\\\\n\\\\r\\\\n\"
jmp     loc_407560"]
Node19 [label = "lea     edx, [esp+134h+name]
push    edx             ; name
call    addr
add     esp, 4
cmp     eax, 0FFFFFFFFh
mov     [esp+134h+var_110], eax
jnz     short loc_407290"]
Node20 [label = "lea     eax, [esp+134h+name]
push    eax
call    orr
jmp     loc_407565"]
Node21 [label = "push    ebx             ; hostshort
push    eax             ; hostlong
call    conn
mov     ebx, eax
add     esp, 8
cmp     ebx, 0FFFFFFFFh
mov     [esp+134h+s], ebx
jnz     short loc_4072B4"]
Node22 [label = "push    offset aConn_0  ; \"conn\"
call    orr
jmp     loc_407565"]
Node23 [label = "mov     ecx, [esp+134h+var_11C]
add     esi, 2
test    ecx, ecx
mov     [esp+134h+var_120], esi
jz      short loc_407340"]
Node24 [label = "mov     esi, [esp+134h+var_118]
sub     esi, 1
mov     eax, 55555556h
imul    esi
mov     eax, edx
shr     eax, 1Fh
add     eax, edx
lea     eax, ds:5[eax*4]
cdq
mov     ebx, eax
push    edx
push    ebx
mov     [esp+13Ch+var_118], ecx
mov     [esp+13Ch+var_108], edx
call    sub_411680
mov     ecx, [esp+13Ch+var_108]
mov     edi, eax
push    ecx
mov     eax, esi
cdq
push    ebx
push    edx
mov     edx, [esp+148h+var_118]
push    eax
push    edx
mov     eax, edi
mov     [esp+150h+var_11C], edi
call    sub_404FF0
add     esp, 1Ch
test    edi, edi
jz      short loc_407338"]
Node25 [label = "mov     eax, edi
lea     edx, [eax+1]
lea     ebx, [ebx+0]"]
Node26 [label = "mov     cl, [eax]
add     eax, 1
test    cl, cl
jnz     short loc_407320"]
Node27 [label = "mov     ebx, [esp+134h+s]
mov     esi, [esp+134h+var_120]
sub     eax, edx
lea     ecx, [eax+17h]
jmp     short loc_407342"]
Node28 [label = "mov     ebx, [esp+134h+s]
mov     esi, [esp+134h+var_120]"]
Node29 [label = "xor     ecx, ecx"]
Node30 [label = "call    sub_401F10
neg     eax
sbb     eax, eax
and     eax, 2Eh
cdq
mov     edi, eax
mov     eax, edx
mov     [esp+134h+s], eax
mov     eax, ecx
cdq
add     edi, eax
mov     eax, [esp+134h+s]
adc     eax, edx
add     edi, [ebp+8]
adc     eax, [ebp+0Ch]
add     edi, 71h
adc     eax, 0
push    eax
movsx   eax, byte ptr [ebp+2]
push    edi
push    eax
call    ktn
mov     edi, eax
add     esp, 0Ch
push    0
mov     eax, esi
sub     eax, ebp
push    71h
sub     eax, 10h
cdq
push    offset aConnectionUpgr; \"Connection: Upgrade\\r\\nUpgrade: websocket\"...
push    edx
push    eax
mov     [esp+148h+var_118], eax
lea     eax, [ebp+10h]
push    eax
lea     ecx, [edi+10h]
push    ecx
mov     [esp+150h+var_114], edx
call    sub_40FCB0
add     esp, 10h
push    eax
call    sub_40FCB0
add     esp, 10h
mov     esi, eax
call    sub_401F10
test    eax, eax
jz      short loc_4073D2"]
Node31 [label = "push    0
push    2Eh
push    offset aSecWebsocketEx; \"Sec-WebSocket-Extensions: permessage-de\"...
push    esi
call    sub_40FCB0
add     esp, 10h
mov     esi, eax"]
Node32 [label = "mov     ecx, [esp+134h+var_11C]
test    ecx, ecx
jz      short loc_40742D"]
Node33 [label = "mov     eax, ecx
lea     edx, [eax+1]
mov     [esp+134h+s], edx"]
Node34 [label = "mov     dl, [eax]
add     eax, 1
test    dl, dl
jnz     short loc_4073E3"]
Node35 [label = "sub     eax, [esp+134h+s]
push    0
push    2
push    offset asc_456998; \"\\r\\n\"
cdq
push    edx
push    eax
push    ecx
push    0
push    15h
push    offset aAuthorizationB; \"Authorization: Basic \"
push    esi
call    sub_40FCB0
add     esp, 10h
push    eax
call    sub_40FCB0
add     esp, 10h
push    eax
call    sub_40FCB0
mov     esi, eax
mov     eax, [esp+144h+var_11C]
push    eax
call    sub_40F950
add     esp, 14h"]
Node36 [label = "mov     ecx, [ebp+8]
sub     ecx, [esp+134h+var_118]
mov     edx, [ebp+0Ch]
sbb     edx, [esp+134h+var_114]
mov     eax, [esp+134h+var_120]
push    edx
push    ecx
push    eax
push    esi
call    sub_40FCB0
push    1               ; int
push    edi             ; int
push    ebx             ; s
call    sub_406C00
push    edi
mov     esi, eax
call    r0
add     esp, 20h
test    esi, esi
jnz     short loc_407470"]
Node37 [label = "push    ebx             ; s
call    sub_40F120
add     esp, 4
xor     eax, eax
jmp     loc_407568"]
Node38 [label = "mov     ecx, [esi+8]
push    offset aSecWebsocketAc; \"\\nSec-WebSocket-Accept: \"
push    ecx
lea     ebp, [esi+10h]
push    ebp
call    sub_4016D0
add     esp, 0Ch
test    eax, eax
jz      loc_407530"]
Node39 [label = "mov     edx, [esp+134h+var_110]; int
push    edx
mov     ecx, offset sub_404F70; int
mov     edi, ebx
call    sub_402D10
push    ebx
mov     [esp+13Ch+s], eax
call    sub_410B90
xor     edi, edi
push    ebx
mov     dword_464EC0[eax*4], edi
call    sub_410B90
mov     dword_46FCC0[eax*4], edi
mov     eax, [esi+8]
push    offset aSecWebsocket_0; \"\\nSec-WebSocket-Extensions: permessage-d\"...
push    eax
push    ebp
call    sub_4016D0
add     esp, 18h
test    eax, eax
jz      short loc_407547"]
Node40 [label = "push    ebx
call    sub_410B90
mov     edi, eax
mov     ebp, edi
shl     ebp, 4
mov     byte ptr ss:dword_465E88[ebp], 1
mov     ecx, [esi+8]
push    offset aClient_no_cont; \"client_no_context_takeover\"
push    ecx
lea     eax, [esi+10h]
push    eax
call    sub_4016D0
add     esp, 10h
test    eax, eax
setnz   dl
mov     [ebp+465E8Ah], dl
mov     ss:dword_465E8C[ebp], 0FFFFFFF1h
call    sub_4023F0
test    eax, eax
jnz     short loc_407547"]
Node41 [label = "push    ebx             ; s
call    sub_40F120
push    offset aCanTInitWebsoc; \"can't init websockets pmce\"
call    krr
add     esp, 8
jmp     short loc_407568"]
Node42 [label = "push    80000000h
call    ki
push    ebx             ; s
mov     [esp+13Ch+s], eax
call    sub_40F120
add     esp, 8"]
Node43 [label = "mov     eax, [esp+134h+s]
push    esi
push    eax
push    2
call    knk
add     esp, 0Ch
jmp     short loc_407568"]
Node44 [label = "mov     ecx, off_4630C4
push    ecx"]
Node45 [label = "call    krr"]
Node46 [label = "add     esp, 4"]
Node47 [label = "mov     ecx, [esp+134h+var_4]
pop     edi
pop     esi
pop     ebp
pop     ebx
xor     ecx, esp
call    @__security_check_cookie@4; __security_check_cookie(x)
add     esp, 124h
retn"]
Node0 -> Node1 [color = "black"]
Node1 -> Node2 [color = "red"]
Node1 -> Node1 [color = "green"]
Node2 -> Node3 [color = "red"]
Node2 -> Node44 [color = "green"]
Node3 -> Node4 [color = "red"]
Node3 -> Node44 [color = "green"]
Node4 -> Node5 [color = "red"]
Node4 -> Node6 [color = "green"]
Node5 -> Node45 [color = "black"]
Node6 -> Node7 [color = "red"]
Node6 -> Node8 [color = "green"]
Node7 -> Node45 [color = "black"]
Node8 -> Node9 [color = "red"]
Node8 -> Node10 [color = "green"]
Node9 -> Node10 [color = "black"]
Node10 -> Node11 [color = "red"]
Node10 -> Node12 [color = "green"]
Node11 -> Node45 [color = "black"]
Node12 -> Node13 [color = "red"]
Node12 -> Node14 [color = "green"]
Node13 -> Node14 [color = "black"]
Node14 -> Node15 [color = "red"]
Node14 -> Node16 [color = "green"]
Node15 -> Node17 [color = "black"]
Node16 -> Node17 [color = "black"]
Node17 -> Node18 [color = "red"]
Node17 -> Node19 [color = "green"]
Node18 -> Node45 [color = "black"]
Node19 -> Node20 [color = "red"]
Node19 -> Node21 [color = "green"]
Node20 -> Node46 [color = "black"]
Node21 -> Node22 [color = "red"]
Node21 -> Node23 [color = "green"]
Node22 -> Node46 [color = "black"]
Node23 -> Node24 [color = "red"]
Node23 -> Node29 [color = "green"]
Node24 -> Node25 [color = "red"]
Node24 -> Node28 [color = "green"]
Node25 -> Node26 [color = "black"]
Node26 -> Node27 [color = "red"]
Node26 -> Node26 [color = "green"]
Node27 -> Node30 [color = "black"]
Node28 -> Node29 [color = "black"]
Node29 -> Node30 [color = "black"]
Node30 -> Node31 [color = "red"]
Node30 -> Node32 [color = "green"]
Node31 -> Node32 [color = "black"]
Node32 -> Node33 [color = "red"]
Node32 -> Node36 [color = "green"]
Node33 -> Node34 [color = "black"]
Node34 -> Node35 [color = "red"]
Node34 -> Node34 [color = "green"]
Node35 -> Node36 [color = "black"]
Node36 -> Node37 [color = "red"]
Node36 -> Node38 [color = "green"]
Node37 -> Node47 [color = "black"]
Node38 -> Node39 [color = "red"]
Node38 -> Node42 [color = "green"]
Node39 -> Node40 [color = "red"]
Node39 -> Node43 [color = "green"]
Node40 -> Node41 [color = "red"]
Node40 -> Node43 [color = "green"]
Node41 -> Node47 [color = "black"]
Node42 -> Node43 [color = "black"]
Node43 -> Node47 [color = "black"]
Node44 -> Node45 [color = "black"]
Node45 -> Node46 [color = "black"]
Node46 -> Node47 [color = "black"]
}